.<!DOCTYPE html>
<html lang="en">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="DartMaster Elite">
<meta name="mobile-web-app-capable" content="yes">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4a6fa5">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DARTS Scorer Pro v1.5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #0f0f0f 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(90deg, #2a2a2a 0%, #333 50%, #2a2a2a 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #444;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 2px;
        }

        .main-menu {
            flex: 1;
            padding: 20px;
        }

        .main-games {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
            max-width: 800px;
            margin: 0 auto 20px auto;
        }

        .party-games-card {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.2) 0%, rgba(255, 140, 0, 0.1) 100%);
            border: 2px solid rgba(255, 165, 0, 0.3);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 800px;
            margin: 0 auto 15px auto;
        }

        .party-games-card:hover {
            border-color: #ff8c00;
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.3) 0%, rgba(255, 165, 0, 0.2) 100%);
            transform: translateY(-5px) scale(1.02);
        }

        .party-games {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            max-width: 800px;
            margin: 0 auto;
        }

        .party-games.show {
            display: grid;
        }

        .menu-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-card:hover {
            border-color: #4a9eff;
            background: linear-gradient(135deg, rgba(74, 158, 255, 0.2) 0%, rgba(74, 158, 255, 0.1) 100%);
            transform: translateY(-5px) scale(1.02);
        }

        .menu-card h2 {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            margin: 0;
        }

        .party-games .menu-card {
            min-height: 80px;
            padding: 15px 10px;
        }

        .party-games .menu-card h2 {
            font-size: 14px;
        }

        .setup-screen {
            display: none;
            flex: 1;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }

        .game-header {
            background: linear-gradient(90deg, #333 0%, #3a3a3a 50%, #333 100%);
            padding: 18px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid #444;
            margin: -20px -20px 20px -20px;
        }

        .back-btn {
            background: linear-gradient(135deg, #666 0%, #555 100%);
            border: none;
            color: #ffffff;
            font-size: 24px;
            cursor: pointer;
            padding: 12px 16px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: linear-gradient(135deg, #777 0%, #666 100%);
            transform: scale(1.1);
        }

        .game-title {
            font-size: 22px;
            font-weight: 700;
            color: #ffffff;
        }

        .setup-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .setup-title {
            font-size: 32px;
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 10px;
        }

        .setup-subtitle {
            font-size: 16px;
            color: #bbb;
            font-weight: 500;
        }

        .setup-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .setup-section h3 {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 15px;
        }

        .player-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .player-input input {
            flex: 1;
            padding: 15px;
            border: 2px solid #555;
            border-radius: 10px;
            background: rgba(64, 64, 64, 0.8);
            color: #ffffff;
            font-size: 14px;
        }

        .add-player-btn, .remove-player-btn {
            background: linear-gradient(135deg, #4a9eff 0%, #3a8eef 100%);
            border: none;
            color: #ffffff;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .remove-player-btn {
            background: linear-gradient(135deg, #ff4a4a 0%, #ef3a3a 100%);
        }

        .start-game-btn {
            background: linear-gradient(135deg, #4a9eff 0%, #3a8eef 100%);
            border: none;
            color: #ffffff;
            padding: 18px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .start-game-btn:hover {
            background: linear-gradient(135deg, #5aa9ff 0%, #4a9eff 100%);
            transform: translateY(-2px);
        }

        .game-interface {
            display: none;
            flex: 1;
            flex-direction: column;
        }

        .progress-bar {
            background: linear-gradient(90deg, #444 0%, #4a4a4a 50%, #444 100%);
            padding: 18px 25px;
            text-align: center;
            border-bottom: 1px solid #555;
        }

        .progress-text {
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
        }

        .target-display {
            background: #2a2a2a;
            padding: 15px;
            border-bottom: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-height: 70px;
        }

        .target-item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            border: 2px solid #555;
            background: #444;
            color: #999;
        }

        .target-item.current {
            border-color: #4a9eff;
            background: #4a9eff;
            color: #fff;
            transform: scale(1.2);
        }

        .target-item.completed {
            border-color: #44ff44;
            background: #44ff44;
            color: #fff;
        }

        .game-content {
            flex: 1;
            display: flex;
        }

        .players-panel {
            width: 40%;
            background: linear-gradient(180deg, #333 0%, #2a2a2a 100%);
            border-right: 2px solid #444;
            overflow-y: auto;
        }

        .input-panel {
            width: 60%;
            background: linear-gradient(180deg, #2a2a2a 0%, #1f1f1f 100%);
            display: flex;
            flex-direction: column;
        }

        .player-item {
            padding: 20px;
            border-bottom: 1px solid #444;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-item.active {
            background: linear-gradient(90deg, rgba(74, 158, 255, 0.2) 0%, rgba(74, 158, 255, 0.1) 100%);
            border-left: 6px solid #4a9eff;
        }

        .player-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #666 0%, #555 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #ffffff;
        }

        .player-item.active .player-icon {
            background: linear-gradient(135deg, #4a9eff 0%, #5aa9ff 100%);
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 2px;
        }

        .player-stats {
            font-size: 12px;
            color: #aaa;
            font-weight: 500;
        }

        .player-score {
            font-size: 24px;
            font-weight: 800;
            color: #ffffff;
            text-align: right;
        }

        .input-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 8px;
            padding: 15px;
            background: #1a1a1a;
        }

        .input-grid.x01-grid {
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 6px;
            padding: 10px;
        }

        .input-button {
            background: linear-gradient(135deg, #404040 0%, #353535 100%);
            border: none;
            color: #ffffff;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80px;
            border-radius: 10px;
        }

        .input-button:hover {
            background: linear-gradient(135deg, #4a4a4a 0%, #404040 100%);
            transform: translateY(-2px);
        }

        .input-button:active {
            transform: translateY(0);
        }

        .input-button.target {
            background: linear-gradient(135deg, #4a9eff 0%, #3a8eef 100%);
        }

        .input-button.double {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
        }

        .input-button.triple {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
        }

        .input-button.miss {
            background: linear-gradient(135deg, #666 0%, #555 100%);
        }

        .input-button.undo {
            background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%);
        }

        .button-main {
            font-size: 20px;
            font-weight: 800;
        }

        .button-sub {
            font-size: 12px;
            font-weight: 500;
            opacity: 0.8;
            margin-top: 2px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #444;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #4a9eff;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .winner-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .winner-popup.active {
            display: flex;
        }

        .winner-content {
            background: linear-gradient(135deg, #333 0%, #2a2a2a 100%);
            border: 2px solid #4a9eff;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 90%;
        }

        .winner-text {
            font-size: 28px;
            font-weight: 800;
            color: #4a9eff;
            margin-bottom: 20px;
        }

        .winner-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .winner-btn {
            background: linear-gradient(135deg, #4a9eff 0%, #3a8eef 100%);
            border: none;
            color: #ffffff;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .winner-btn:hover {
            background: linear-gradient(135deg, #5aa9ff 0%, #4a9eff 100%);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .game-content {
                flex-direction: column;
            }
            
            .players-panel {
                width: 100%;
                max-height: 40vh;
            }
            
            .input-panel {
                width: 100%;
            }
            
            .main-games {
                grid-template-columns: 1fr;
            }
            
            .party-games {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                <img src="jamie-tech-prints-logo.png" 
                     alt="Jamie Tech Prints Logo" 
                     style="width: 50px; height: 50px; object-fit: contain;" 
                     onerror="this.style.display='none';">
                <div style="text-align: center;">
                    <h1 style="margin: 0; font-size: 28px; font-weight: 800; background: linear-gradient(135deg, #4a6fa5 0%, #5a7fb5 50%, #4a6fa5 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">üéØ DartMaster Elite</h1>
                    <div style="font-size: 12px; color: #4a6fa5; font-weight: 600; margin-top: 2px;">Professional Scoring System by Jamie Tech Prints</div>
                </div>
            </div>
        </div>

                    <!-- Main Menu -->
        <div id="main-menu" class="main-menu">
            <!-- Standard Games -->
            <div class="main-games">
                <div class="menu-card" onclick="setupGame('x01')">
                    <h2>X01</h2>
                </div>
                <div class="menu-card" onclick="setupGame('cricket')">
                    <h2>Cricket</h2>
                </div>
            </div>

            <!-- Menu Options -->
            <div class="main-games" style="margin-top: 15px;">
                <div class="menu-card" onclick="showStatistics()" style="background: linear-gradient(135deg, rgba(255, 140, 0, 0.2) 0%, rgba(255, 165, 0, 0.1) 100%); border-color: rgba(255, 140, 0, 0.3);">
                    <h2>üìä Statistics</h2>
                </div>
                <div class="menu-card" onclick="showProfiles()" style="background: linear-gradient(135deg, rgba(0, 255, 127, 0.2) 0%, rgba(0, 200, 100, 0.1) 100%); border-color: rgba(0, 255, 127, 0.3);">
                    <h2>üë§ Profiles</h2>
                </div>
            </div>

            <!-- Party Games Section -->
            <div class="party-games-card" onclick="togglePartyGames()">
                <h2>Party games</h2>
            </div>
            
            <div id="party-games-grid" class="party-games">
                <div class="menu-card" onclick="setupGame('shooter')">
                    <h2>Shooter</h2>
                </div>
                <div class="menu-card" onclick="setupGame('shanghai')">
                    <h2>Shanghai</h2>
                </div>
                <div class="menu-card" onclick="setupGame('split')">
                    <h2>Split Score</h2>
                </div>
                <div class="menu-card" onclick="setupGame('clock')">
                    <h2>Around Clock</h2>
                </div>
                <div class="menu-card" onclick="setupGame('120')">
                    <h2>1-20 Random</h2>
                </div>
                <div class="menu-card" onclick="setupGame('killer')">
                    <h2>Killer</h2>
                </div>
                <div class="menu-card" onclick="setupGame('golf')">
                    <h2>Golf</h2>
                </div>
                <div class="menu-card" onclick="setupGame('baseball')">
                    <h2>Baseball</h2>
                </div>
                <div class="menu-card" onclick="setupGame('elimination')">
                    <h2>Elimination</h2>
                </div>
                <div class="menu-card" onclick="setupGame('highscore')">
                    <h2>Highscore</h2>
                </div>
            </div>
        </div>

        <!-- Statistics Screen -->
        <div id="statistics-screen" class="setup-screen" style="display: none;">
            <div class="game-header">
                <button class="back-btn" onclick="showMainMenu()">‚Üê</button>
                <div class="game-title">Statistics</div>
                <div></div>
            </div>

            <div class="setup-header">
                <div class="setup-title">üìä Game Statistics</div>
                <div class="setup-subtitle">Your performance across all games</div>
            </div>

            <div class="setup-section">
                <h3>üéØ OVERALL STATS</h3>
                <div id="overall-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <!-- Overall stats will be populated here -->
                </div>
            </div>

            <div class="setup-section">
                <h3>üéÆ GAME BREAKDOWN</h3>
                <div id="game-breakdown" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <!-- Game-specific stats will be populated here -->
                </div>
            </div>

            <div class="setup-section">
                <h3>üèÜ ACHIEVEMENTS</h3>
                <div id="achievements" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <!-- Achievements will be populated here -->
                </div>
            </div>

            <button class="start-game-btn" onclick="clearAllStats()" style="background: linear-gradient(135deg, #ff4a4a 0%, #ef3a3a 100%); margin-top: 20px;">üóëÔ∏è Clear All Statistics</button>
        </div>

        <!-- Profiles Screen -->
        <div id="profiles-screen" class="setup-screen" style="display: none;">
            <div class="game-header">
                <button class="back-btn" onclick="showMainMenu()">‚Üê</button>
                <div class="game-title">Player Profiles</div>
                <div></div>
            </div>

            <div class="setup-header">
                <div class="setup-title">üë§ Player Profiles</div>
                <div class="setup-subtitle">Manage and view player statistics</div>
            </div>

            <div class="setup-section">
                <h3>‚ûï CREATE NEW PROFILE</h3>
               <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="new-profile-name" placeholder="Enter player name" style="flex: 1; padding: 15px; border: 2px solid #555; border-radius: 10px; background: rgba(64, 64, 64, 0.8); color: #ffffff; font-size: 14px;">
                    <button class="add-player-btn" onclick="createProfile()">Create Profile</button>
                </div>
            </div>

            <div class="setup-section">
                <h3>üë• SAVED PROFILES</h3>
                <div id="saved-profiles" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                    <!-- Saved profiles will be populated here -->
                </div>
            </div>

            <button class="start-game-btn" onclick="clearAllProfiles()" style="background: linear-gradient(135deg, #ff4a4a 0%, #ef3a3a 100%); margin-top: 20px;">üóëÔ∏è Clear All Profiles</button>
        </div>
        <div id="setup-screen" class="setup-screen">
            <div class="game-header">
                <button class="back-btn" onclick="showMainMenu()">‚Üê</button>
                <div class="game-title" id="setup-game-title">Game Setup</div>
                <div></div>
            </div>

            <div class="setup-header">
                <div class="setup-title" id="setup-title">Game</div>
                <div class="setup-subtitle" id="setup-subtitle">Setup your game</div>
            </div>

            <!-- X01 Setup -->
            <div id="x01-setup" class="setup-section" style="display: none;">
                <h3>‚öôÔ∏è X01 OPTIONS</h3>
                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                    <div style="flex: 1;">
                        <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Starting Score:</label>
                        <select id="x01-score" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                            <option value="301">301</option>
                            <option value="501" selected>501</option>
                            <option value="701">701</option>
                            <option value="1001">1001</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Start Rule:</label>
                        <select id="x01-start" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                            <option value="single" selected>Single In</option>
                            <option value="double">Double In</option>
                            <option value="master">Master In</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 20px;">
                    <div style="flex: 1;">
                        <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Finish Rule:</label>
                        <select id="x01-finish" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                            <option value="single">Single Out</option>
                            <option value="double" selected>Double Out</option>
                            <option value="master">Master Out</option>
                        </select>
                    </div>
                    <div style="flex: 1;"></div>
                </div>
            </div>

            <!-- Shooter Setup -->
            <div id="shooter-setup" class="setup-section" style="display: none;">
                <h3>‚öôÔ∏è SHOOTER OPTIONS</h3>
                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                    <div style="flex: 1;">
                        <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Rounds:</label>
                        <select id="shooter-rounds" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                            <option value="5">5</option>
                            <option value="7" selected>7</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 30px;">
                            <label style="color: #ccc; font-weight: 600;">Include Bull:</label>
                            <div class="toggle-switch active" id="shooter-bull-toggle" onclick="toggleShooterBull()">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <label style="color: #ccc; font-weight: 600;">Half Score on Miss:</label>
                    <div class="toggle-switch" id="shooter-half-toggle" onclick="toggleShooterHalf()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <!-- Shanghai Setup -->
            <div id="shanghai-setup" class="setup-section" style="display: none;">
                <h3>‚öôÔ∏è SHANGHAI OPTIONS</h3>
                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                    <div style="flex: 1;">
                        <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Start Number:</label>
                        <select id="shanghai-start" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                            <option value="1" selected>1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">End Number:</label>
                        <select id="shanghai-end" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7" selected>7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                            <option value="20">20</option>
                            <option value="25">Bull (25)</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <label style="color: #ccc; font-weight: 600;">Half Score on Miss:</label>
                    <div class="toggle-switch active" id="shanghai-half-toggle" onclick="toggleShanghaiHalf()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <!-- Around Clock Setup -->
            <div id="clock-setup" class="setup-section" style="display: none;">
                <h3>‚öôÔ∏è AROUND CLOCK OPTIONS</h3>
                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                    <div style="flex: 1;">
                        <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Order:</label>
                        <select id="clock-order" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                            <option value="ascending" selected>Ascending (1-20)</option>
                            <option value="descending">Descending (20-1)</option>
                            <option value="random">Random</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 30px;">
                            <label style="color: #ccc; font-weight: 600;">Include Bull:</label>
                            <div class="toggle-switch active" id="clock-bull-toggle" onclick="toggleClockBull()">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <label style="color: #ccc; font-weight: 600;">Quick Mode (Double = Skip 2, Triple = Skip 3):</label>
                    <div class="toggle-switch" id="clock-quick-toggle" onclick="toggleClockQuick()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <!-- 1-20 Random Setup -->
            <div id="120-setup" class="setup-section" style="display: none;">
                <h3>‚öôÔ∏è 1-20 RANDOM OPTIONS</h3>
                <div style="display: flex; gap: 20px;">
                    <div style="flex: 1;">
                        <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Order:</label>
                        <select id="120-order" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                            <option value="ascending" selected>Ascending (1-20)</option>
                            <option value="descending">Descending (20-1)</option>
                            <option value="random">Random</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Cricket Setup -->
            <div id="cricket-setup" class="setup-section" style="display: none;">
                <h3>‚öôÔ∏è CRICKET OPTIONS</h3>
                <p style="color: #bbb;">Hit numbers 15-20 and Bull three times each to close them. First to close all numbers with highest score wins.</p>
            </div>

            <!-- Other Games Setup -->
            <div id="other-setup" class="setup-section" style="display: none;">
                <h3>‚öôÔ∏è GAME INFO</h3>
                <p id="other-description" style="color: #bbb; line-height: 1.6; margin-bottom: 15px;">Fun party game with standard rules.</p>
                
                <!-- Game-specific options will be added here -->
                <div id="killer-options" style="display: none;">
                    <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Lives per Player:</label>
                            <select id="killer-lives" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                                <option value="3">3 Lives</option>
                                <option value="5" selected>5 Lives</option>
                                <option value="7">7 Lives</option>
                            </select>
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-top: 30px;">
                                <label style="color: #ccc; font-weight: 600;">Random Numbers:</label>
                                <div class="toggle-switch active" id="killer-random-toggle" onclick="toggleKillerRandom()">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="golf-options" style="display: none;">
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Number of Holes:</label>
                            <select id="golf-holes" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                                <option value="9" selected>9 Holes</option>
                                <option value="18">18 Holes</option>
                            </select>
                        </div>
                        <div style="flex: 1;"></div>
                    </div>
                </div>

                <div id="baseball-options" style="display: none;">
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Innings:</label>
                            <select id="baseball-innings" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                                <option value="7">7 Innings</option>
                                <option value="9" selected>9 Innings</option>
                            </select>
                        </div>
                        <div style="flex: 1;"></div>
                    </div>
                </div>

                <div id="elimination-options" style="display: none;">
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Darts per Round:</label>
                            <select id="elimination-darts" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                                <option value="3" selected>3 Darts</option>
                                <option value="5">5 Darts</option>
                                <option value="6">6 Darts</option>
                            </select>
                        </div>
                        <div style="flex: 1;"></div>
                    </div>
                </div>

                <div id="highscore-options" style="display: none;">
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <label style="color: #ccc; font-weight: 600; display: block; margin-bottom: 8px;">Total Darts:</label>
                            <select id="highscore-darts" style="width: 100%; padding: 12px; border-radius: 8px; background: #444; color: white; border: 2px solid #555;">
                                <option value="9">9 Darts</option>
                                <option value="12">12 Darts</option>
                                <option value="15" selected>15 Darts</option>
                                <option value="21">21 Darts</option>
                            </select>
                        </div>
                        <div style="flex: 1;"></div>
                    </div>
                </div>
            </div>

            <!-- Split Score Options -->
            <div id="split-options" class="setup-section" style="display: none;">
                <h3>‚öôÔ∏è SPLIT SCORE OPTIONS</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <label style="color: #ccc; font-weight: 600;">Half Score on Miss:</label>
                    <div class="toggle-switch active" id="half-score-toggle" onclick="toggleHalfScore()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <!-- Players Section -->
            <div class="setup-section">
                <h3>üë• PLAYERS</h3>
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <label style="color: #ccc; font-weight: 600;">Single Player Mode:</label>
                    <div class="toggle-switch" id="single-player-toggle" onclick="toggleSinglePlayer()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div id="players-list">
                    <div class="player-input">
                        <input type="text" placeholder="Player 1" value="Player 1">
                        <button class="remove-player-btn" onclick="removePlayer(this)" style="display: none;">-</button>
                    </div>
                    <div class="player-input">
                        <input type="text" placeholder="Player 2" value="Player 2">
                        <button class="remove-player-btn" onclick="removePlayer(this)" style="display: none;">-</button>
                    </div>
                </div>
                <button class="add-player-btn" onclick="addPlayer()" id="add-player-btn">+ Add Player</button>
            </div>

            <button class="start-game-btn" onclick="startGame()">Start Game!</button>
        </div>

        <!-- Game Interface -->
        <div id="game-interface" class="game-interface">
            <div class="game-header">
                <button class="back-btn" onclick="forceExit()" id="game-back-btn">‚Üê</button>
                <div class="game-title" id="game-title">Game</div>
                <div></div>
            </div>

            <div class="progress-bar">
                <div class="progress-text" id="progress-text">Good luck!</div>
            </div>

            <div class="target-display" id="target-display" style="display: none;"></div>

            <div class="game-content">
                <div class="players-panel" id="players-panel"></div>
                <div class="input-panel">
                    <div class="input-grid" id="input-grid"></div>
                </div>
            </div>
        </div>

        <!-- Exit Confirmation Popup -->
        <div id="exit-popup" class="winner-popup">
            <div class="winner-content">
                <div class="winner-text">Exit Game?</div>
                <div style="margin: 20px 0; color: #ccc; text-align: center;">
                    Are you sure you want to exit? All progress will be lost.
                </div>
                <div class="winner-buttons">
                    <button class="winner-btn" onclick="confirmExitGame()">‚úì Exit Game</button>
                    <button class="winner-btn" onclick="cancelExit()" style="background: linear-gradient(135deg, #666 0%, #555 100%);">‚úó Stay</button>
                </div>
            </div>
        </div>

        <!-- Winner Popup -->
        <div id="winner-popup" class="winner-popup">
            <div class="winner-content">
                <div class="winner-text" id="winner-text">üèÜ Winner! üèÜ</div>
                <div id="game-stats" style="margin: 20px 0; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; text-align: left;">
                    <h3 style="color: #4a9eff; margin-bottom: 15px; text-align: center;">üìä GAME STATISTICS</h3>
                    <div id="stats-content" style="color: #ccc; line-height: 1.6;"></div>
                </div>
                <div class="winner-buttons">
                    <button class="winner-btn" onclick="playAgain()">üîÑ Play Again</button>
                    <button class="winner-btn" onclick="showMainMenu()">üè† Main Menu</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        var gameState = {
            type: '',
            players: [],
            currentPlayer: 0,
            currentDart: 1,
            gameActive: false,
            currentRound: 1,
            currentTarget: null,
            targets: [],
            currentTargetIndex: 0,
            hasHitTarget: false,
            options: {
                splitHalfScore: true,
                shooterIncludeBull: true,
                shooterHalfScore: false,
                shanghaiHalfScore: false,
                shanghaiEnd: 7,
                clockIncludeBull: true,
                clockQuickMode: false,
                shooterRounds: 7,
                x01Score: 501,
                x01Finish: 'double',
                clockOrder: 'ascending',
                order120: 'ascending'
            }
        };

        var partyGamesVisible = false;

        // Game names and descriptions
        var gameInfo = {
            'x01': { name: 'X01', desc: 'Classic countdown game - first to zero wins!' },
            'cricket': { name: 'Cricket', desc: 'Hit 15-20 and Bull three times each' },
            'shooter': { name: 'Shooter', desc: 'Hit specific targets to score points' },
            'shanghai': { name: 'Shanghai', desc: 'Hit single, double, and triple of each number' },
            'split': { name: 'Split Score', desc: 'Add up your score - highest total wins!' },
            'clock': { name: 'Around Clock', desc: 'Hit numbers in sequence around the clock' },
            '120': { name: '1-20 Random', desc: 'Hit numbers 1-20 in order' },
            'killer': { name: 'Killer', desc: 'Eliminate other players by hitting their numbers' },
            'golf': { name: 'Golf', desc: 'Lowest score wins - like golf!' },
            'baseball': { name: 'Baseball', desc: 'Score runs by hitting the right inning numbers' },
            'elimination': { name: 'Elimination', desc: 'Last player standing wins' },
            'highscore': { name: 'Highscore', desc: 'Get the highest score in limited throws' }
        };

        // Show main menu
        function showMainMenu() {
            console.log('showMainMenu called');
            
            // Hide all screens first
            var screens = ['main-menu', 'setup-screen', 'game-interface', 'statistics-screen', 'profiles-screen'];
            screens.forEach(function(screenId) {
                var screen = document.getElementById(screenId);
                if (screen) {
                    screen.style.display = 'none';
                }
            });
            
            // Hide winner popup
            var winnerPopup = document.getElementById('winner-popup');
            if (winnerPopup) {
                winnerPopup.classList.remove('active');
            }
            
            // Show main menu
            var mainMenu = document.getElementById('main-menu');
            if (mainMenu) {
                mainMenu.style.display = 'block';
                console.log('Main menu display set to block');
            } else {
                console.error('Main menu element not found!');
            }
            
            // Ensure game is not active
            gameState.gameActive = false;
            
            console.log('Main menu should now be visible');
        }

        // Toggle party games
        function togglePartyGames() {
            var grid = document.getElementById('party-games-grid');
            partyGamesVisible = !partyGamesVisible;
            
            if (partyGamesVisible) {
                grid.style.display = 'grid';
                grid.classList.add('show');
            } else {
                grid.style.display = 'none';
                grid.classList.remove('show');
            }
        }

        // Setup game
        function setupGame(type) {
            gameState.type = type;
            
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('setup-screen').style.display = 'block';
            
            // Update titles
            document.getElementById('setup-game-title').textContent = 'Setup ' + gameInfo[type].name;
            document.getElementById('setup-title').textContent = gameInfo[type].name;
            document.getElementById('setup-subtitle').textContent = gameInfo[type].desc;
            
            // Hide all setup sections
            var sections = ['x01-setup', 'shooter-setup', 'shanghai-setup', 'clock-setup', '120-setup', 'cricket-setup', 'other-setup', 'split-options'];
            sections.forEach(function(id) {
                var el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });
            
            // Show relevant setup section
            if (type === 'x01') {
                document.getElementById('x01-setup').style.display = 'block';
            } else if (type === 'shooter') {
                document.getElementById('shooter-setup').style.display = 'block';
            } else if (type === 'shanghai') {
                document.getElementById('shanghai-setup').style.display = 'block';
            } else if (type === 'clock') {
                document.getElementById('clock-setup').style.display = 'block';
            } else if (type === '120') {
                document.getElementById('120-setup').style.display = 'block';
            } else if (type === 'cricket') {
                document.getElementById('cricket-setup').style.display = 'block';
            } else if (type === 'split') {
                document.getElementById('split-options').style.display = 'block';
            } else if (type === 'killer') {
                document.getElementById('other-setup').style.display = 'block';
                document.getElementById('killer-options').style.display = 'block';
                document.getElementById('other-description').textContent = 'Each player gets a number. Hit other players\' numbers to eliminate their lives. Last player standing wins!';
            } else if (type === 'golf') {
                document.getElementById('other-setup').style.display = 'block';
                document.getElementById('golf-options').style.display = 'block';
                document.getElementById('other-description').textContent = 'Play 9 or 18 holes. Lowest score wins, just like golf! Par for each hole is based on the number.';
            } else if (type === 'baseball') {
                document.getElementById('other-setup').style.display = 'block';
                document.getElementById('baseball-options').style.display = 'block';
                document.getElementById('other-description').textContent = 'Play 9 innings (numbers 1-9). Score runs by hitting the inning number. Most runs after 9 innings wins!';
            } else if (type === 'elimination') {
                document.getElementById('other-setup').style.display = 'block';
                document.getElementById('elimination-options').style.display = 'block';
                document.getElementById('other-description').textContent = 'Players are eliminated if they score the lowest in a round. Last player remaining wins!';
            } else if (type === 'highscore') {
                document.getElementById('other-setup').style.display = 'block';
                document.getElementById('highscore-options').style.display = 'block';
                document.getElementById('other-description').textContent = 'Limited number of darts to score as many points as possible. Highest total score wins!';
            } else {
                document.getElementById('other-setup').style.display = 'block';
                document.getElementById('other-description').textContent = gameInfo[type].desc;
            }
        }

        // Player management
        function addPlayer() {
            var playersList = document.getElementById('players-list');
            var playerCount = playersList.children.length;
            
            if (playerCount < 8) {
                var div = document.createElement('div');
                div.className = 'player-input';
                div.innerHTML = '<input type="text" placeholder="Player ' + (playerCount + 1) + '" value="Player ' + (playerCount + 1) + '"><button class="remove-player-btn" onclick="removePlayer(this)">-</button>';
                playersList.appendChild(div);
                
                updateRemoveButtons();
            }
        }

        function removePlayer(btn) {
            btn.parentElement.remove();
            updateRemoveButtons();
        }

        function updateRemoveButtons() {
            var players = document.querySelectorAll('.player-input');
            players.forEach(function(player, index) {
                var btn = player.querySelector('.remove-player-btn');
                btn.style.display = players.length > 2 ? 'block' : 'none';
            });
        }

        // Toggle functions
        function toggleShooterBull() {
            var toggle = document.getElementById('shooter-bull-toggle');
            toggle.classList.toggle('active');
            gameState.options.shooterIncludeBull = toggle.classList.contains('active');
        }

        function toggleShooterHalf() {
            var toggle = document.getElementById('shooter-half-toggle');
            toggle.classList.toggle('active');
            gameState.options.shooterHalfScore = toggle.classList.contains('active');
        }

        function toggleClockBull() {
            var toggle = document.getElementById('clock-bull-toggle');
            toggle.classList.toggle('active');
            gameState.options.clockIncludeBull = toggle.classList.contains('active');
        }

        function toggleHalfScore() {
            var toggle = document.getElementById('half-score-toggle');
            toggle.classList.toggle('active');
            gameState.options.splitHalfScore = toggle.classList.contains('active');
        }

        // Start game
        
function startGame() {
    console.log('startGame called');
    
    // Get players
    var playerInputs = document.querySelectorAll('.player-input input');
    gameState.players = [];
    
    console.log('Single player mode:', singlePlayerMode);
    console.log('Player inputs found:', playerInputs.length);
    
    if (singlePlayerMode) {
        // Single player mode
        var name = playerInputs[0].value.trim() || 'You';
        gameState.players.push(createPlayer(name, gameState.type));
        console.log('Added single player:', name);
    } else {
        // Multiplayer mode - fixed logic
        for (var i = 0; i < playerInputs.length; i++) {
            var input = playerInputs[i];
            var playerDiv = input.parentElement;
            var name = input.value.trim();
            
            // Only add players with names and visible inputs
            if (name && playerDiv.style.display !== 'none') {
                gameState.players.push(createPlayer(name, gameState.type));
                console.log('Added player:', name);
            }
        }
        
        // Ensure at least 2 players for multiplayer
        if (gameState.players.length < 2) {
            alert('Please enter at least 2 player names for multiplayer mode.');
            return;
        }
    }
    
    console.log('Total players:', gameState.players.length);
    
    if (gameState.players.length === 0) {
        alert('No players found. Please check player names.');
        return;
    }

    // Get game options
    if (gameState.type === 'x01') {
        gameState.options.x01Score = parseInt(document.getElementById('x01-score').value);
        gameState.options.x01Start = document.getElementById('x01-start').value;
        gameState.options.x01Finish = document.getElementById('x01-finish').value;
    } else if (gameState.type === 'shooter') {
        gameState.options.shooterRounds = parseInt(document.getElementById('shooter-rounds').value);
    } else if (gameState.type === 'shanghai') {
        gameState.options.shanghaiStart = parseInt(document.getElementById('shanghai-start').value);
        gameState.options.shanghaiEnd = parseInt(document.getElementById('shanghai-end').value);
    } else if (gameState.type === 'clock') {
        gameState.options.clockOrder = document.getElementById('clock-order').value;
    } else if (gameState.type === '120') {
        gameState.options.order120 = document.getElementById('120-order').value;
    }

    // Initialize game
    try {
        initializeGame();
        
        // Show game interface
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('game-interface').style.display = 'flex';
        
        gameState.gameActive = true;
        gameState.currentPlayer = 0;
        gameState.currentDart = 1;
        
        updateGameInterface();
        console.log('Game started successfully');
    } catch (error) {
        console.error('Error starting game:', error);
        alert('Error starting game: ' + error.message);
    }
}
        // Create player object
        function createPlayer(name, gameType) {
            var player = {
                name: name,
                score: 0,
                dartsThrown: 0,
                rounds: 0,
                gameStarted: false
            };

            if (gameType === 'x01') {
                player.score = gameState.options.x01Score;
                player.average = 0;
                player.checkoutAttempts = 0;
                player.gameStarted = false; // Need to hit starting rule first
            } else if (gameType === 'cricket') {
                player.marks = {15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0, 25: 0};
            } else if (gameType === 'shooter') {
                player.targets = [];
                player.currentTargetIndex = 0;
            } else if (gameType === 'shanghai') {
                player.currentNumber = gameState.options.shanghaiStart;
                player.hits = {single: false, double: false, triple: false};
            } else if (gameType === 'clock' || gameType === '120') {
                player.currentTargetIndex = 0;
                player.completed = false;
            } else if (gameType === 'killer') {
                player.lives = 5;
                player.killer = false;
                player.targetNumber = null;
            } else if (gameType === 'golf') {
                player.holes = [];
                player.currentHole = 1;
            } else if (gameType === 'baseball') {
                player.innings = {};
                player.currentInning = 1;
            }

            return player;
        }

        // Initialize game specific data
        function initializeGame() {
            if (gameState.type === 'shooter') {
                initializeShooterTargets();
            } else if (gameState.type === 'clock') {
                initializeClockTargets();
            } else if (gameState.type === '120') {
                initialize120Targets();
            } else if (gameState.type === 'killer') {
                assignKillerNumbers();
            }
        }

        // Initialize targets for different games
        function initializeShooterTargets() {
            var targets = [];
            for (var i = 1; i <= 20; i++) {
                targets.push(i);
            }
            if (gameState.options.shooterIncludeBull) {
                targets.push(25);
            }
            
            // Shuffle targets
            for (var i = targets.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = targets[i];
                targets[i] = targets[j];
                targets[j] = temp;
            }
            
            gameState.targets = targets.slice(0, gameState.options.shooterRounds);
            gameState.currentTargetIndex = 0;
            gameState.currentTarget = gameState.targets[0];
        }

        function initializeClockTargets() {
            var targets = [];
            for (var i = 1; i <= 20; i++) {
                targets.push(i);
            }
            
            if (gameState.options.clockOrder === 'descending') {
                targets.reverse();
            } else if (gameState.options.clockOrder === 'random') {
                for (var i = targets.length - 1; i > 0; i--) {
                    var j = Math.floor(Math.random() * (i + 1));
                    var temp = targets[i];
                    targets[i] = targets[j];
                    targets[j] = temp;
                }
            }
            
            if (gameState.options.clockIncludeBull) {
                targets.push(25);
            }
            
            gameState.targets = targets;
            gameState.currentTargetIndex = 0;
            gameState.currentTarget = gameState.targets[0];
        }

        function initialize120Targets() {
            var targets = [];
            for (var i = 1; i <= 20; i++) {
                targets.push(i);
            }
            
            if (gameState.options.order120 === 'descending') {
                targets.reverse();
            } else if (gameState.options.order120 === 'random') {
                for (var i = targets.length - 1; i > 0; i--) {
                    var j = Math.floor(Math.random() * (i + 1));
                    var temp = targets[i];
                    targets[i] = targets[j];
                    targets[j] = temp;
                }
            }
            
            gameState.targets = targets;
            gameState.currentTargetIndex = 0;
            gameState.currentTarget = gameState.targets[0];
        }

        function assignKillerNumbers() {
            var numbers = [];
            for (var i = 1; i <= 20; i++) {
                numbers.push(i);
            }
            
            // Shuffle numbers
            for (var i = numbers.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = numbers[i];
                numbers[i] = numbers[j];
                numbers[j] = temp;
            }
            
            gameState.players.forEach(function(player, index) {
                player.targetNumber = numbers[index];
            });
        }

        // Update game interface
        function updateGameInterface() {
            document.getElementById('game-title').textContent = gameInfo[gameState.type].name;
            updateProgressText();
            updateTargetDisplay();
            updatePlayersPanel();
            updateInputGrid();
        }

        function updateProgressText() {
            var text = '';
            var player = gameState.players[gameState.currentPlayer];
            
            if (gameState.type === 'x01') {
                var modeText = x01Mode === 'double' ? ' (DOUBLE MODE)' : x01Mode === 'triple' ? ' (TRIPLE MODE)' : '';
                if (singlePlayerMode || gameState.players.length === 1) {
                    text = "Dart " + gameState.currentDart + " of 3" + modeText;
                } else {
                    text = player.name + "'s turn - Dart " + gameState.currentDart + " of 3" + modeText;
                }
                if (!player.gameStarted) {
                    text += " - Must hit " + gameState.options.x01Start + " to start!";
                }
            } else if (gameState.type === 'shooter') {
                text = 'Round ' + (gameState.currentTargetIndex + 1) + ' of ' + gameState.options.shooterRounds + ' - Target: ' + gameState.currentTarget;
            } else if (gameState.type === 'shanghai') {
                var shanghaiStatus = '';
                var hits = player.hits;
                if (hits.single && hits.double && (hits.triple || player.currentNumber === 25)) {
                    shanghaiStatus = ' - SHANGHAI POSSIBLE!';
                }
                if (singlePlayerMode || gameState.players.length === 1) {
                    text = "Target: " + player.currentNumber + " - Score: " + player.score + shanghaiStatus;
                } else {
                    text = player.name + "'s turn - Target: " + player.currentNumber + " - Score: " + player.score + shanghaiStatus;
                }
            } else if (gameState.type === 'clock') {
                var quickText = gameState.options.clockQuickMode ? ' (Quick Mode)' : '';
                if (singlePlayerMode || gameState.players.length === 1) {
                    text = "Target: " + gameState.targets[player.currentTargetIndex] + quickText;
                } else {
                    text = player.name + "'s turn - Target: " + gameState.targets[player.currentTargetIndex] + quickText;
                }
            } else if (gameState.type === '120') {
                if (singlePlayerMode || gameState.players.length === 1) {
                    text = "Target: " + gameState.targets[player.currentTargetIndex];
                } else {
                    text = player.name + "'s turn - Target: " + gameState.targets[player.currentTargetIndex];
                }
            } else {
                if (singlePlayerMode || gameState.players.length === 1) {
                    text = "Dart " + gameState.currentDart + " of 3";
                } else {
                    text = player.name + "'s turn - Dart " + gameState.currentDart + " of 3";
                }
            }
            
            document.getElementById('progress-text').textContent = text;
        }

        function updateTargetDisplay() {
            var display = document.getElementById('target-display');
            
            if (gameState.type === 'shooter' || gameState.type === 'clock' || gameState.type === '120' || gameState.type === 'shanghai') {
                display.style.display = 'flex';
                display.innerHTML = '';
                
                var targets, currentIndex;
                
                if (gameState.type === 'shooter') {
                    targets = gameState.targets;
                    currentIndex = gameState.currentTargetIndex;
                } else if (gameState.type === 'shanghai') {
                    // Show sequence from start to end for Shanghai
                    targets = [];
                    for (var i = gameState.options.shanghaiStart; i <= gameState.options.shanghaiEnd; i++) {
                        targets.push(i);
                    }
                    var currentPlayer = gameState.players[gameState.currentPlayer];
                    currentIndex = currentPlayer.currentNumber - gameState.options.shanghaiStart;
                } else {
                    targets = gameState.targets;
                    currentIndex = gameState.players[gameState.currentPlayer].currentTargetIndex;
                }
                
                targets.forEach(function(target, index) {
                    var item = document.createElement('div');
                    item.className = 'target-item';
                    item.textContent = target === 25 ? 'B' : target;
                    
                    if (index === currentIndex) {
                        item.classList.add('current');
                    } else if (index < currentIndex) {
                        item.classList.add('completed');
                    }
                    
                    display.appendChild(item);
                });
            } else {
                display.style.display = 'none';
            }
        }

        function updatePlayersPanel() {
            var panel = document.getElementById('players-panel');
            panel.innerHTML = '';
            
            gameState.players.forEach(function(player, index) {
                var item = document.createElement('div');
                item.className = 'player-item' + (index === gameState.currentPlayer ? ' active' : '');
                
                var stats = getPlayerStats(player);
                
                item.innerHTML = 
                    '<div class="player-icon">' + (index + 1) + '</div>' +
                    '<div class="player-info">' +
                        '<div class="player-name">' + player.name + '</div>' +
                        '<div class="player-stats">' + stats + '</div>' +
                    '</div>' +
                    '<div class="player-score">' + getPlayerScore(player) + '</div>';
                
                panel.appendChild(item);
            });
        }

        function getPlayerStats(player) {
            if (gameState.type === 'x01') {
                var avg = player.dartsThrown > 0 ? ((gameState.options.x01Score - player.score) * 3 / player.dartsThrown).toFixed(1) : '0.0';
                return 'Avg: ' + avg + ' | Darts: ' + player.dartsThrown;
            } else if (gameState.type === 'cricket') {
                var totalMarks = Object.values(player.marks).reduce(function(a, b) { return a + b; }, 0);
                return 'Marks: ' + totalMarks + ' | Score: ' + player.score;
            } else if (gameState.type === 'shooter') {
                return 'Round: ' + (player.currentTargetIndex + 1) + ' | Hits: ' + player.targets.length;
            } else if (gameState.type === 'shanghai') {
                var hits = Object.values(player.hits).filter(Boolean).length;
                return 'Number: ' + player.currentNumber + ' | Hits: ' + hits + '/3';
            } else {
                return 'Darts: ' + player.dartsThrown + ' | Round: ' + player.rounds;
            }
        }

        function getPlayerScore(player) {
            if (gameState.type === 'cricket') {
                return player.score;
            } else if (gameState.type === 'shooter') {
                return player.score;
            } else if (gameState.type === 'shanghai') {
                return player.score;
            } else if (gameState.type === 'killer') {
                return player.lives + '‚ô•';
            } else {
                return player.score;
            }
        }

        function updateInputGrid() {
            var grid = document.getElementById('input-grid');
            grid.innerHTML = '';
            
            if (gameState.type === 'x01') {
                createX01InputGrid(grid);
            } else if (gameState.type === 'shooter' || gameState.type === 'shanghai' || gameState.type === 'clock' || gameState.type === '120') {
                createTargetInputGrid(grid);
            } else if (gameState.type === 'cricket') {
                createCricketInputGrid(grid);
            } else if (gameState.type === 'split') {
                createSplitInputGrid(grid);
            } else {
                createStandardInputGrid(grid);
            }
        }

        function createX01InputGrid(grid) {
            // Create number selection interface for X01
            grid.className = 'input-grid x01-grid';
            
            // Numbers 1-20 (first 20 buttons)
            for (var i = 1; i <= 20; i++) {
                var btn = document.createElement('button');
                btn.className = 'input-button target';
                btn.style.minHeight = '60px';
                btn.innerHTML = '<div class="button-main" style="font-size: 16px;">' + i + '</div>';
                btn.onclick = (function(num) {
                    return function() { handleX01NumberInput(num, x01Mode); };
                })(i);
                grid.appendChild(btn);
            }
            
            // Control buttons (4 buttons to make 24 total)
            var doubleBtn = document.createElement('button');
            doubleBtn.className = 'input-button double';
            doubleBtn.style.minHeight = '60px';
            doubleBtn.innerHTML = '<div class="button-main" style="font-size: 14px;">DOUBLE</div>';
            doubleBtn.onclick = function() { toggleX01Mode('double'); };
            grid.appendChild(doubleBtn);
            
            var tripleBtn = document.createElement('button');
            tripleBtn.className = 'input-button triple';
            tripleBtn.style.minHeight = '60px';
            tripleBtn.innerHTML = '<div class="button-main" style="font-size: 14px;">TRIPLE</div>';
            tripleBtn.onclick = function() { toggleX01Mode('triple'); };
            grid.appendChild(tripleBtn);
            
            var innerBullBtn = document.createElement('button');
            innerBullBtn.className = 'input-button target';
            innerBullBtn.style.minHeight = '60px';
            innerBullBtn.innerHTML = '<div class="button-main" style="font-size: 12px;">BULL</div><div class="button-sub">25</div>';
            innerBullBtn.onclick = function() { handleX01NumberInput(25, 'single'); };
            grid.appendChild(innerBullBtn);
            
            var outerBullBtn = document.createElement('button');
            outerBullBtn.className = 'input-button double';
            outerBullBtn.style.minHeight = '60px';
            outerBullBtn.innerHTML = '<div class="button-main" style="font-size: 12px;">D-BULL</div><div class="button-sub">50</div>';
            outerBullBtn.onclick = function() { handleX01NumberInput(25, 'double'); };
            grid.appendChild(outerBullBtn);
        }

        // Global state for X01 mode
        var x01Mode = 'single';

        function toggleX01Mode(mode) {
            x01Mode = mode;
            // Update button appearances to show selected mode
            var buttons = document.querySelectorAll('.input-button');
            buttons.forEach(function(btn) {
                btn.style.boxShadow = '';
            });
            
            // Highlight the selected mode button
            var modeBtn = document.querySelector('.input-button.' + mode);
            if (modeBtn) {
                modeBtn.style.boxShadow = '0 0 15px rgba(255, 255, 255, 0.5)';
            }
        }

        function handleX01NumberInput(number, type) {
            var player = gameState.players[gameState.currentPlayer];
            var multiplier = x01Mode === 'double' ? 2 : x01Mode === 'triple' ? 3 : 1;
            var finalType = type === 'miss' ? 'miss' : x01Mode;
            
            // Special handling for bull
            if (number === 25) {
                multiplier = type === 'double' ? 2 : 1;
                finalType = type;
            }
            
            var points = number * multiplier;
            
            // Check if player has started the game (for start rules)
            if (!player.gameStarted && finalType !== 'miss') {
                var canStart = true;
                if (gameState.options.x01Start === 'double' && finalType !== 'double') {
                    canStart = false;
                } else if (gameState.options.x01Start === 'master' && finalType !== 'double' && finalType !== 'triple') {
                    canStart = false;
                }
                
                if (canStart) {
                    player.gameStarted = true;
                } else {
                    // Can't start yet - no score change
                    player.dartsThrown++;
                    x01Mode = 'single'; // Reset mode
                    nextTurn();
                    return;
                }
            }
            
            if (finalType !== 'miss' && player.gameStarted) {
                if (player.score - points >= 0) {
                    if (player.score - points === 0) {
                        // Check finish rules
                        var canFinish = true;
                        if (gameState.options.x01Finish === 'double' && finalType !== 'double') {
                            canFinish = false;
                        } else if (gameState.options.x01Finish === 'master' && finalType !== 'double' && finalType !== 'triple') {
                            canFinish = false;
                        }
                        
                        if (canFinish) {
                            player.score = 0;
                            x01Mode = 'single'; // Reset mode
                            declareWinner(player, 'CHECKOUT!');
                            return;
                        } else {
                            // Bust - score remains the same, but end turn
                        }
                    } else {
                        player.score -= points;
                    }
                } else {
                    // Bust - score remains the same
                }
            }
            
            player.dartsThrown++;
            x01Mode = 'single'; // Reset mode after each dart
            nextTurn();
        }

        function createTargetInputGrid(grid) {
            var currentTarget;
            
            if (gameState.type === 'shooter') {
                currentTarget = gameState.currentTarget;
            } else if (gameState.type === 'shanghai') {
                currentTarget = gameState.players[gameState.currentPlayer].currentNumber;
            } else {
                currentTarget = gameState.targets[gameState.players[gameState.currentPlayer].currentTargetIndex];
            }
            
            // Row 1: Target, Double, Triple
            var targetBtn = createButton('target', currentTarget === 25 ? 'BULL' : currentTarget, currentTarget === 25 ? '25' : 'Hit');
            
            var doubleText = currentTarget === 25 ? '50' : 'D' + currentTarget;
            if (gameState.type === 'clock' && gameState.options.clockQuickMode && currentTarget !== 25) {
                doubleText += ' +2';
            }
            var doubleBtn = createButton('double', 'DOUBLE', doubleText);
            
            var tripleText = currentTarget === 25 ? '50' : 'T' + currentTarget;
            if (gameState.type === 'clock' && gameState.options.clockQuickMode && currentTarget !== 25) {
                tripleText += ' +3';
            }
            var tripleBtn = createButton('triple', 'TRIPLE', tripleText);
            
            if (currentTarget === 25) {
                tripleBtn.style.opacity = '0.5';
                tripleBtn.style.pointerEvents = 'none';
            }
            
            // Row 2: Miss, Undo, Empty
            var missText = '0 points';
            if (gameState.type === 'shooter' && gameState.options.shooterHalfScore) {
                missText = 'Half score';
            } else if (gameState.type === 'shanghai' && gameState.options.shanghaiHalfScore) {
                missText = 'Half score';
            }
            
            var missBtn = createButton('miss', 'MISS', missText);
            var undoBtn = createButton('undo', 'UNDO', 'Last dart');
            var emptyBtn = createButton('', '', '');
            emptyBtn.style.opacity = '0.3';
            emptyBtn.style.pointerEvents = 'none';
            
            grid.appendChild(targetBtn);
            grid.appendChild(doubleBtn);
            grid.appendChild(tripleBtn);
            grid.appendChild(missBtn);
            grid.appendChild(undoBtn);
            grid.appendChild(emptyBtn);
        }

        function createCricketInputGrid(grid) {
            var targets = [15, 16, 17, 18, 19, 20];
            
            targets.forEach(function(target) {
                var btn = createButton('target', target, 'Hit ' + target);
                btn.onclick = function() { hitCricketTarget(target, 1); };
                grid.appendChild(btn);
            });
        }

        function createSplitInputGrid(grid) {
            // Row 1: Target, Double, Triple
            var targetBtn = createButton('target', 'TARGET', 'Single hit');
            var doubleBtn = createButton('double', 'DOUBLE', 'x2 points');
            var tripleBtn = createButton('triple', 'TRIPLE', 'x3 points');
            
            // Row 2: Miss, Undo, Empty
            var missBtn = createButton('miss', 'MISS', gameState.options.splitHalfScore ? 'Half score' : '0 points');
            var undoBtn = createButton('undo', 'UNDO', 'Last dart');
            var emptyBtn = createButton('', '', '');
            emptyBtn.style.opacity = '0.3';
            emptyBtn.style.pointerEvents = 'none';
            
            grid.appendChild(targetBtn);
            grid.appendChild(doubleBtn);
            grid.appendChild(tripleBtn);
            grid.appendChild(missBtn);
            grid.appendChild(undoBtn);
            grid.appendChild(emptyBtn);
        }

        function createStandardInputGrid(grid) {
            // Create standard 3x2 layout for other games
            var buttons = [
                {text: 'SINGLE', sub: 'Hit', class: 'target'},
                {text: 'DOUBLE', sub: 'x2', class: 'double'},
                {text: 'TRIPLE', sub: 'x3', class: 'triple'},
                {text: 'MISS', sub: '0', class: 'miss'},
                {text: 'UNDO', sub: 'Last', class: 'undo'},
                {text: '', sub: '', class: ''}
            ];
            
            buttons.forEach(function(btn) {
                var button = createButton(btn.class, btn.text, btn.sub);
                if (!btn.text) {
                    button.style.opacity = '0.3';
                    button.style.pointerEvents = 'none';
                }
                grid.appendChild(button);
            });
        }

        function createButton(className, mainText, subText) {
            var btn = document.createElement('button');
            btn.className = 'input-button ' + className;
            btn.innerHTML = '<div class="button-main">' + mainText + '</div><div class="button-sub">' + subText + '</div>';
            btn.onclick = function() { handleInput(className, mainText); };
            return btn;
        }

        // Handle input
        function handleInput(type, value) {
            if (!gameState.gameActive) return;
            
            if (type === 'undo') {
                undoLastDart();
                return;
            }
            
            var player = gameState.players[gameState.currentPlayer];
            var points = 0;
            var hit = false;
            
            if (gameState.type === 'shooter') {
                hit = handleShooterInput(type, player);
            } else if (gameState.type === 'shanghai') {
                hit = handleShanghaiInput(type, player);
            } else if (gameState.type === 'clock' || gameState.type === '120') {
                hit = handleClockInput(type, player);
            } else if (gameState.type === 'split') {
                handleSplitInput(type, player);
            }
            // Note: X01 now uses handleX01NumberInput directly
            
            // Move to next dart/player
            nextTurn();
        }

        function handleShooterInput(type, player) {
            var currentTarget = gameState.currentTarget;
            var points = 0;
            var hit = false;
            
            if (type === 'target') {
                points = currentTarget;
                hit = true;
            } else if (type === 'double' && currentTarget !== 25) {
                points = currentTarget * 2;
                hit = true;
            } else if (type === 'triple' && currentTarget !== 25) {
                points = currentTarget * 3;
                hit = true;
            } else if (type === 'double' && currentTarget === 25) {
                points = 50;
                hit = true;
            }
            
            if (hit) {
                player.score += points;
                player.targets.push({target: currentTarget, points: points});
                gameState.hasHitTarget = true;
            } else if (type === 'miss' && gameState.options.shooterHalfScore) {
                player.score = Math.floor(player.score / 2);
            }
            
            player.dartsThrown++;
            return hit;
        }

        function handleShanghaiInput(type, player) {
            var currentNumber = player.currentNumber;
            var points = 0;
            var hit = false;
            
            // Calculate points based on hit type
            if (type === 'target') {
                points = currentNumber;
                hit = true;
                if (!player.hits.single) player.hits.single = true;
            } else if (type === 'double') {
                if (currentNumber === 25) {
                    points = 50; // Double bull
                } else {
                    points = currentNumber * 2;
                }
                hit = true;
                if (!player.hits.double) player.hits.double = true;
            } else if (type === 'triple' && currentNumber !== 25) {
                points = currentNumber * 3;
                hit = true;
                if (!player.hits.triple) player.hits.triple = true;
            } else if (type === 'miss') {
                // Handle miss with half score option
                if (gameState.options.shanghaiHalfScore) {
                    player.score = Math.floor(player.score / 2);
                }
            }
            
            // Add points if hit
            if (hit) {
                player.score += points;
            }
            
            // Check for Shanghai (hit single, double, AND triple in the same round)
            if (player.hits.single && player.hits.double && (player.hits.triple || currentNumber === 25)) {
                declareWinner(player, 'SHANGHAI!');
                return hit;
            }
            
            player.dartsThrown++;
            return hit;
        }

        function handleClockInput(type, player) {
            var currentTarget = gameState.targets[player.currentTargetIndex];
            var hit = false;
            var skipCount = 0;
            
            if ((type === 'target' || type === 'double' || type === 'triple') && 
                (currentTarget !== 25 || type !== 'triple')) {
                
                hit = true;
                
                // Quick mode: calculate how many numbers to skip
                if (gameState.options.clockQuickMode) {
                    if (type === 'double') {
                        skipCount = 2; // Skip next 2 numbers
                    } else if (type === 'triple') {
                        skipCount = 3; // Skip next 3 numbers
                    } else {
                        skipCount = 1; // Normal advance
                    }
                } else {
                    skipCount = 1; // Normal mode - always advance by 1
                }
                
                // Advance player's target index
                player.currentTargetIndex += skipCount;
                
                // Check if player completed the course
                if (player.currentTargetIndex >= gameState.targets.length) {
                    player.completed = true;
                    declareWinner(player, 'COMPLETED!');
                    return hit;
                }
            }
            
            player.dartsThrown++;
            return hit;
        }

        function handleSplitInput(type, player) {
            if (type === 'miss') {
                if (gameState.options.splitHalfScore) {
                    player.score = Math.floor(player.score / 2);
                }
            } else {
                // For split score, we need to know what number was hit
                // This is a simplified version - in a real app you'd have number selection
                var randomScore = Math.floor(Math.random() * 20) + 1;
                var multiplier = type === 'double' ? 2 : type === 'triple' ? 3 : 1;
                player.score += randomScore * multiplier;
            }
            
            player.dartsThrown++;
        }

        function handleX01Input(type, player) {
            // This function is now replaced by handleX01NumberInput
            // Keeping for compatibility but not used
        }

        function nextTurn() {
            gameState.currentDart++;
            
            if (gameState.currentDart > 3) {
                gameState.currentDart = 1;
                gameState.currentPlayer++;
                
                // Check for end of round in certain games
                if (gameState.type === 'shooter' && gameState.currentPlayer >= gameState.players.length) {
                    nextShooterRound();
                    return;
                } else if (gameState.type === 'shanghai' && gameState.currentPlayer >= gameState.players.length) {
                    nextShanghaiRound();
                    return;
                }
                
                if (gameState.currentPlayer >= gameState.players.length) {
                    gameState.currentPlayer = 0;
                    gameState.currentRound++;
                }
            }
            
            updateGameInterface();
        }

        function nextShooterRound() {
            gameState.currentPlayer = 0;
            gameState.currentTargetIndex++;
            
            if (gameState.currentTargetIndex >= gameState.targets.length) {
                // Game over - find winner
                var winner = gameState.players.reduce(function(prev, current) {
                    return current.score > prev.score ? current : prev;
                });
                declareWinner(winner, 'HIGH SCORE!');
            } else {
                gameState.currentTarget = gameState.targets[gameState.currentTargetIndex];
                gameState.hasHitTarget = false;
                updateGameInterface();
            }
        }

        function nextShanghaiRound() {
            gameState.currentPlayer = 0;
            
            // Move all players to next number
            var playersFinished = 0;
            gameState.players.forEach(function(player) {
                if (player.currentNumber < gameState.options.shanghaiEnd) {
                    player.currentNumber++;
                    player.hits = {single: false, double: false, triple: false};
                } else {
                    playersFinished++;
                }
            });
            
            // Check if all players finished
            if (playersFinished === gameState.players.length) {
                // All players finished - find winner
                var winner = gameState.players.reduce(function(prev, current) {
                    return current.score > prev.score ? current : prev;
                });
                declareWinner(winner, 'HIGH SCORE!');
            } else {
                updateGameInterface();
            }
        }

        function undoLastDart() {
            if (!gameState.gameActive) return;
            
            var currentPlayer = gameState.players[gameState.currentPlayer];
            
            // Can't undo if no darts thrown yet
            if (currentPlayer.dartsThrown === 0) return;
            
            // Simple undo - just decrement dart count and reset to previous state
            // This is a basic implementation - a full undo would need to track dart history
            if (gameState.currentDart > 1) {
                gameState.currentDart--;
                currentPlayer.dartsThrown--;
            } else {
                // Go back to previous player's last dart
                if (gameState.currentPlayer > 0) {
                    gameState.currentPlayer--;
                    gameState.currentDart = 3;
                    gameState.players[gameState.currentPlayer].dartsThrown--;
                } else if (gameState.currentRound > 1) {
                    // Go to last player of previous round
                    gameState.currentPlayer = gameState.players.length - 1;
                    gameState.currentDart = 3;
                    gameState.currentRound--;
                    gameState.players[gameState.currentPlayer].dartsThrown--;
                }
            }
            
            // Reset X01 mode
            if (gameState.type === 'x01') {
                x01Mode = 'single';
            }
            
            updateGameInterface();
        }

        function hitCricketTarget(target, multiplier) {
            var player = gameState.players[gameState.currentPlayer];
            var marksToAdd = multiplier;
            
            // Add marks
            player.marks[target] += marksToAdd;
            
            // If more than 3 marks and target is closed for all opponents, add score
            if (player.marks[target] > 3) {
                var allOpponentsClosed = gameState.players.every(function(p, index) {
                    return index === gameState.currentPlayer || p.marks[target] >= 3;
                });
                
                if (!allOpponentsClosed) {
                    var extraMarks = player.marks[target] - 3;
                    player.score += target * extraMarks;
                }
                
                player.marks[target] = 3; // Cap at 3 for display
            }
            
            // Check for cricket win
            var allClosed = Object.values(player.marks).every(function(marks) {
                return marks >= 3;
            });
            
            if (allClosed) {
                var hasHighestScore = gameState.players.every(function(p, index) {
                    return index === gameState.currentPlayer || p.score <= player.score;
                });
                
                if (hasHighestScore) {
                    declareWinner(player, 'CRICKET!');
                    return;
                }
            }
            
            player.dartsThrown++;
            nextTurn();
        }

        // Declare winner
        function declareWinner(player, winType) {
            gameState.gameActive = false;
            var winText = 'üèÜ ' + player.name + ' Wins! üèÜ';
            if (winType) {
                winText = 'üéå ' + player.name + ' - ' + winType + ' üéå';
            }
            document.getElementById('winner-text').textContent = winText;
            
            // Update statistics
            updateStatistics(player, winType);
            
            // Generate game statistics
            generateGameStats();
            
            document.getElementById('winner-popup').classList.add('active');
        }

        // Update statistics after game
        function updateStatistics(winner, winType) {
            // Update overall stats
            gameStatistics.totalGames++;
            gameStatistics.totalDarts += gameState.players.reduce(function(total, p) { return total + p.dartsThrown; }, 0);
            
            // Update game-specific stats
            var gameStats = gameStatistics.gameStats[gameState.type];
            if (gameStats) {
                gameStats.played++;
                
                // Check if this is a player profile game
                var winnerIsProfile = playerProfiles[winner.name];
                if (winnerIsProfile) {
                    gameStatistics.gamesWon++;
                    gameStats.won++;
                    
                    // Update player profile
                    var profile = playerProfiles[winner.name];
                    profile.gamesPlayed++;
                    profile.gamesWon++;
                    profile.totalDarts += winner.dartsThrown;
                    
                    // Game-specific profile updates
                    if (gameState.type === 'x01') {
                        var average = winner.dartsThrown > 0 ? ((gameState.options.x01Score - winner.score) * 3 / winner.dartsThrown) : 0;
                        gameStats.bestAverage = Math.max(gameStats.bestAverage, average);
                        profile.averageScore = profile.totalDarts > 0 ? (profile.totalDarts / profile.gamesPlayed) : 0;
                    } else if (gameState.type === 'shanghai' && winType === 'SHANGHAI!') {
                        gameStats.shanghais++;
                        profile.achievements.push('üéå Shanghai! - ' + new Date().toLocaleDateString());
                    } else if (winner.score !== undefined) {
                        gameStats.bestScore = Math.max(gameStats.bestScore, winner.score);
                        profile.averageScore = ((profile.averageScore * (profile.gamesPlayed - 1)) + winner.score) / profile.gamesPlayed;
                    }
                    
                    // Add achievement for first win
                    if (profile.gamesWon === 1) {
                        profile.achievements.push('üèÜ First Victory! - ' + new Date().toLocaleDateString());
                    }
                }
            }
            
            saveData();
        }

        // Generate game statistics
        function generateGameStats() {
            var statsContent = document.getElementById('stats-content');
            var html = '';
            
            // Sort players by performance
            var sortedPlayers = gameState.players.slice().sort(function(a, b) {
                if (gameState.type === 'x01') {
                    return a.score - b.score; // Lower score is better
                } else {
                    return b.score - a.score; // Higher score is better
                }
            });
            
            html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';
            
            sortedPlayers.forEach(function(player, index) {
                var position = index + 1;
                var medal = position === 1 ? 'ü•á' : position === 2 ? 'ü•à' : position === 3 ? 'ü•â' : position + '.';
                
                html += '<div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border-left: 4px solid ' + 
                        (position === 1 ? '#FFD700' : position === 2 ? '#C0C0C0' : position === 3 ? '#CD7F32' : '#666') + ';">';
                html += '<div style="font-weight: bold; color: white; margin-bottom: 8px;">' + medal + ' ' + player.name + '</div>';
                
                if (gameState.type === 'x01') {
                    var avg = player.dartsThrown > 0 ? ((gameState.options.x01Score - player.score) * 3 / player.dartsThrown).toFixed(1) : '0.0';
                    html += '<div>Score: <strong>' + player.score + '</strong></div>';
                    html += '<div>Darts: <strong>' + player.dartsThrown + '</strong></div>';
                    html += '<div>Average: <strong>' + avg + '</strong></div>';
                    html += '<div>Started: <strong>' + (player.gameStarted ? 'Yes' : 'No') + '</strong></div>';
                } else if (gameState.type === 'cricket') {
                    var totalMarks = Object.values(player.marks).reduce(function(a, b) { return a + b; }, 0);
                    html += '<div>Score: <strong>' + player.score + '</strong></div>';
                    html += '<div>Marks: <strong>' + totalMarks + '</strong></div>';
                    html += '<div>Darts: <strong>' + player.dartsThrown + '</strong></div>';
                } else if (gameState.type === 'shooter') {
                    var hitRate = player.dartsThrown > 0 ? ((player.targets.length / player.dartsThrown) * 100).toFixed(1) : '0.0';
                    html += '<div>Score: <strong>' + player.score + '</strong></div>';
                    html += '<div>Targets Hit: <strong>' + player.targets.length + '</strong></div>';
                    html += '<div>Darts: <strong>' + player.dartsThrown + '</strong></div>';
                    html += '<div>Hit Rate: <strong>' + hitRate + '%</strong></div>';
                } else if (gameState.type === 'shanghai') {
                    var totalHits = Object.values(player.hits).filter(Boolean).length;
                    html += '<div>Score: <strong>' + player.score + '</strong></div>';
                    html += '<div>Final Number: <strong>' + player.currentNumber + '</strong></div>';
                    html += '<div>Darts: <strong>' + player.dartsThrown + '</strong></div>';
                } else if (gameState.type === 'clock' || gameState.type === '120') {
                    html += '<div>Completed: <strong>' + (player.completed ? 'Yes' : 'No') + '</strong></div>';
                    html += '<div>Progress: <strong>' + player.currentTargetIndex + '/' + gameState.targets.length + '</strong></div>';
                    html += '<div>Darts: <strong>' + player.dartsThrown + '</strong></div>';
                } else {
                    html += '<div>Score: <strong>' + player.score + '</strong></div>';
                    html += '<div>Darts: <strong>' + player.dartsThrown + '</strong></div>';
                }
                
                html += '</div>';
            });
            
            html += '</div>';
            
            // Game summary
            html += '<div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #444;">';
            html += '<div style="text-align: center; color: #aaa;">';
            html += '<div>Game: <strong>' + gameInfo[gameState.type].name + '</strong></div>';
            html += '<div>Players: <strong>' + gameState.players.length + '</strong></div>';
            html += '<div>Total Rounds: <strong>' + gameState.currentRound + '</strong></div>';
            
            var totalDarts = gameState.players.reduce(function(sum, p) { return sum + p.dartsThrown; }, 0);
            html += '<div>Total Darts: <strong>' + totalDarts + '</strong></div>';
            html += '</div></div>';
            
            statsContent.innerHTML = html;
        }

        // Play again
        function playAgain() {
            document.getElementById('winner-popup').classList.remove('active');
            setupGame(gameState.type);
        }

        // Force exit - new function for mid-game exit
        function forceExit() {
            console.log('forceExit called, gameActive:', gameState.gameActive);
            
            if (gameState.gameActive) {
                // Show custom exit confirmation dialog
                document.getElementById('exit-popup').classList.add('active');
            } else {
                // No game active, go straight to main menu
                showMainMenu();
            }
        }

        // Confirm exit from custom dialog
        function confirmExitGame() {
            console.log('User confirmed exit, resetting game state');
            
            // Hide exit popup
            document.getElementById('exit-popup').classList.remove('active');
            
            // Reset all game state completely
            gameState = {
                type: '',
                players: [],
                currentPlayer: 0,
                currentDart: 1,
                gameActive: false,
                currentRound: 1,
                currentTarget: null,
                targets: [],
                currentTargetIndex: 0,
                hasHitTarget: false,
                options: {
                    splitHalfScore: true,
                    shooterIncludeBull: true,
                    shooterHalfScore: false,
                    shanghaiHalfScore: false,
                    shanghaiStart: 1,
                    shanghaiEnd: 7,
                    clockIncludeBull: true,
                    clockQuickMode: false,
                    shooterRounds: 7,
                    x01Score: 501,
                    x01Start: 'single',
                    x01Finish: 'double',
                    clockOrder: 'ascending',
                    order120: 'ascending'
                }
            };
            
            // Reset X01 mode
            x01Mode = 'single';
            
            console.log('Game state reset, showing main menu');
            showMainMenu();
        }

        // Cancel exit from custom dialog
        function cancelExit() {
            console.log('User cancelled exit');
            document.getElementById('exit-popup').classList.remove('active');
        }

        // Confirm exit
        function confirmExit() {
            if (gameState.gameActive) {
                forceExit();
            } else {
                showMainMenu();
            }
        }

        function toggleClockQuick() {
            var toggle = document.getElementById('clock-quick-toggle');
            toggle.classList.toggle('active');
            gameState.options.clockQuickMode = toggle.classList.contains('active');
        }

        function toggleShanghaiHalf() {
            var toggle = document.getElementById('shanghai-half-toggle');
            toggle.classList.toggle('active');
            gameState.options.shanghaiHalfScore = toggle.classList.contains('active');
        }

        // Player profiles and statistics storage
        var playerProfiles = {};
        var gameStatistics = {
            totalGames: 0,
            totalDarts: 0,
            gamesWon: 0,
            gameStats: {
                'x01': { played: 0, won: 0, bestAverage: 0, bestFinish: 0 },
                'cricket': { played: 0, won: 0, bestScore: 0, fastestWin: 0 },
                'shooter': { played: 0, won: 0, bestScore: 0, bestAccuracy: 0 },
                'shanghai': { played: 0, won: 0, bestScore: 0, shanghais: 0 },
                'split': { played: 0, won: 0, bestScore: 0 },
                'clock': { played: 0, won: 0, fastestWin: 0 },
                '120': { played: 0, won: 0, fastestWin: 0 },
                'killer': { played: 0, won: 0 },
                'golf': { played: 0, won: 0, bestScore: 0 },
                'baseball': { played: 0, won: 0, bestScore: 0 },
                'elimination': { played: 0, won: 0 },
                'highscore': { played: 0, won: 0, bestScore: 0 }
            }
        };

        // Load saved data on startup
        function loadSavedData() {
            try {
                var savedProfiles = JSON.parse(localStorage.getItem('dartmaster_profiles') || '{}');
                var savedStats = JSON.parse(localStorage.getItem('dartmaster_statistics') || '{}');
                
                playerProfiles = savedProfiles;
                if (Object.keys(savedStats).length > 0) {
                    gameStatistics = savedStats;
                }
            } catch (e) {
                console.log('No saved data found or error loading data');
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('dartmaster_profiles', JSON.stringify(playerProfiles));
                localStorage.setItem('dartmaster_statistics', JSON.stringify(gameStatistics));
            } catch (e) {
                console.log('Error saving data:', e);
            }
        }

        // Show statistics screen
        function showStatistics() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('statistics-screen').style.display = 'block';
            populateStatistics();
        }

        // Show profiles screen  
        function showProfiles() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('profiles-screen').style.display = 'block';
            populateProfiles();
        }

        // Populate statistics display
        function populateStatistics() {
            // Overall stats
            var overallHTML = '';
            var winRate = gameStatistics.totalGames > 0 ? ((gameStatistics.gamesWon / gameStatistics.totalGames) * 100).toFixed(1) : 0;
            var avgDartsPerGame = gameStatistics.totalGames > 0 ? (gameStatistics.totalDarts / gameStatistics.totalGames).toFixed(1) : 0;
            
            overallHTML += '<div style="background: rgba(74, 158, 255, 0.1); padding: 15px; border-radius: 10px; text-align: center;">';
            overallHTML += '<div style="font-size: 24px; font-weight: bold; color: #4a9eff;">' + gameStatistics.totalGames + '</div>';
            overallHTML += '<div style="color: #ccc;">Total Games</div></div>';
            
            overallHTML += '<div style="background: rgba(68, 255, 68, 0.1); padding: 15px; border-radius: 10px; text-align: center;">';
            overallHTML += '<div style="font-size: 24px; font-weight: bold; color: #44ff44;">' + gameStatistics.gamesWon + '</div>';
            overallHTML += '<div style="color: #ccc;">Games Won</div></div>';
            
            overallHTML += '<div style="background: rgba(255, 140, 0, 0.1); padding: 15px; border-radius: 10px; text-align: center;">';
            overallHTML += '<div style="font-size: 24px; font-weight: bold; color: #ff8c00;">' + winRate + '%</div>';
            overallHTML += '<div style="color: #ccc;">Win Rate</div></div>';
            
            overallHTML += '<div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; text-align: center;">';
            overallHTML += '<div style="font-size: 24px; font-weight: bold; color: #fff;">' + avgDartsPerGame + '</div>';
            overallHTML += '<div style="color: #ccc;">Avg Darts/Game</div></div>';
            
            document.getElementById('overall-stats').innerHTML = overallHTML;
            
            // Game breakdown
            var gameHTML = '';
            Object.keys(gameStatistics.gameStats).forEach(function(gameType) {
                var stats = gameStatistics.gameStats[gameType];
                if (stats.played > 0) {
                    var gameWinRate = ((stats.won / stats.played) * 100).toFixed(1);
                    gameHTML += '<div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; border-left: 4px solid #4a9eff;">';
                    gameHTML += '<h4 style="color: #4a9eff; margin: 0 0 10px 0;">' + gameInfo[gameType].name + '</h4>';
                    gameHTML += '<div style="color: #ccc; line-height: 1.5;">';
                    gameHTML += 'Played: <strong>' + stats.played + '</strong><br>';
                    gameHTML += 'Won: <strong>' + stats.won + '</strong><br>';
                    gameHTML += 'Win Rate: <strong>' + gameWinRate + '%</strong><br>';
                    
                    // Game-specific stats
                    if (gameType === 'x01' && stats.bestAverage > 0) {
                        gameHTML += 'Best Average: <strong>' + stats.bestAverage.toFixed(1) + '</strong>';
                    } else if (stats.bestScore > 0) {
                        gameHTML += 'Best Score: <strong>' + stats.bestScore + '</strong>';
                    }
                    
                    gameHTML += '</div></div>';
                }
            });
            
            if (!gameHTML) {
                gameHTML = '<div style="text-align: center; color: #666; padding: 40px;">No game statistics yet. Play some games to see your stats!</div>';
            }
            
            document.getElementById('game-breakdown').innerHTML = gameHTML;
            
            // Achievements
            populateAchievements();
        }

        // Populate achievements
        function populateAchievements() {
            var achievementsHTML = '';
            var achievements = [
                { name: 'First Game', condition: gameStatistics.totalGames >= 1, icon: 'üéØ' },
                { name: 'Getting Started', condition: gameStatistics.totalGames >= 10, icon: 'üèÉ' },
                { name: 'Dedicated Player', condition: gameStatistics.totalGames >= 50, icon: 'üéÆ' },
                { name: 'Century Club', condition: gameStatistics.totalGames >= 100, icon: 'üíØ' },
                { name: 'First Win', condition: gameStatistics.gamesWon >= 1, icon: 'üèÜ' },
                { name: 'Winner', condition: gameStatistics.gamesWon >= 10, icon: 'ü•á' },
                { name: 'Champion', condition: gameStatistics.gamesWon >= 25, icon: 'üëë' },
                { name: 'Shanghai Master', condition: gameStatistics.gameStats.shanghai.shanghais >= 1, icon: 'üéå' },
                { name: 'Perfect Game', condition: gameStatistics.gameStats.x01.bestAverage >= 100, icon: '‚≠ê' }
            ];
            
            achievements.forEach(function(achievement) {
                var unlocked = achievement.condition;
                achievementsHTML += '<div style="background: ' + (unlocked ? 'rgba(68, 255, 68, 0.1)' : 'rgba(100, 100, 100, 0.1)') + '; padding: 10px; border-radius: 8px; text-align: center; opacity: ' + (unlocked ? '1' : '0.5') + ';">';
                achievementsHTML += '<div style="font-size: 20px;">' + achievement.icon + '</div>';
                achievementsHTML += '<div style="font-size: 12px; color: ' + (unlocked ? '#44ff44' : '#666') + '; font-weight: bold;">' + achievement.name + '</div>';
                achievementsHTML += '</div>';
            });
            
            document.getElementById('achievements').innerHTML = achievementsHTML;
        }

        // Clear all statistics
        function clearAllStats() {
            if (confirm('Are you sure you want to clear all statistics? This cannot be undone.')) {
                gameStatistics = {
                    totalGames: 0,
                    totalDarts: 0,
                    gamesWon: 0,
                    gameStats: {
                        'x01': { played: 0, won: 0, bestAverage: 0, bestFinish: 0 },
                        'cricket': { played: 0, won: 0, bestScore: 0, fastestWin: 0 },
                        'shooter': { played: 0, won: 0, bestScore: 0, bestAccuracy: 0 },
                        'shanghai': { played: 0, won: 0, bestScore: 0, shanghais: 0 },
                        'split': { played: 0, won: 0, bestScore: 0 },
                        'clock': { played: 0, won: 0, fastestWin: 0 },
                        '120': { played: 0, won: 0, fastestWin: 0 },
                        'killer': { played: 0, won: 0 },
                        'golf': { played: 0, won: 0, bestScore: 0 },
                        'baseball': { played: 0, won: 0, bestScore: 0 },
                        'elimination': { played: 0, won: 0 },
                        'highscore': { played: 0, won: 0, bestScore: 0 }
                    }
                };
                saveData();
                populateStatistics();
            }
        }

        // Toggle single player mode
        function toggleSinglePlayer() {
            var toggle = document.getElementById('single-player-toggle');
            toggle.classList.toggle('active');
            singlePlayerMode = toggle.classList.contains('active');
            
            var playersList = document.getElementById('players-list');
            var addPlayerBtn = document.getElementById('add-player-btn');
            
            if (singlePlayerMode) {
                // Hide all player inputs except first one
                var playerInputs = playersList.querySelectorAll('.player-input');
                for (var i = 1; i < playerInputs.length; i++) {
                    playerInputs[i].style.display = 'none';
                }
                // Hide add player button
                addPlayerBtn.style.display = 'none';
                // Set first player name to "You"
                var firstInput = playersList.querySelector('.player-input input');
                if (firstInput) {
                    firstInput.value = 'You';
                }
            } else {
                // Show all player inputs
                var playerInputs = playersList.querySelectorAll('.player-input');
                playerInputs.forEach(function(input) {
                    input.style.display = 'flex';
                });
                // Show add player button
                addPlayerBtn.style.display = 'block';
                // Reset first player name
                var firstInput = playersList.querySelector('.player-input input');
                if (firstInput && firstInput.value === 'You') {
                    firstInput.value = 'Player 1';
                }
            }
            
            updateRemoveButtons();
        }

        function toggleKillerRandom() {
            var toggle = document.getElementById('killer-random-toggle');
            toggle.classList.toggle('active');
            gameState.options.killerRandom = toggle.classList.contains('active');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            showMainMenu();
            updateRemoveButtons();
        });

        // Initialize immediately as backup
        loadSavedData();
        showMainMenu();
    </script>
</body>
</html>
